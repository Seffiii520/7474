<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ã‚¿ã‚¹ã‚¯å¯¾æ±º</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  margin: 0;
  background: #f5f5f5;
}
header {
  background: #222;
  color: white;
  padding: 10px;
  display: flex;
  justify-content: space-between;
}
button {
  padding: 8px 12px;
  border: none;
  border-radius: 6px;
}
.container {
  padding: 10px;
}
.hidden { display:none; }
.task {
  display:flex;
  justify-content:space-between;
  background:white;
  margin:6px 0;
  padding:10px;
  border-radius:8px;
}
.calendar button {
  margin:3px;
}
</style>
</head>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<body>
<script>
firebase.initializeApp(firebaseConfig);
const database = firebase.database();
</script>

<header>
  <div>ã‚¿ã‚¹ã‚¯å¯¾æ±º</div>
  <button onclick="toggleMenu()">â˜°</button>
</header>

<div class="container hidden" id="menu">
  <button onclick="showHome()">ğŸ  ä»Šæ—¥</button>
  <button onclick="showStats()">ğŸ“Š ã‚°ãƒ©ãƒ•</button>
  <button onclick="showCalendar()">ğŸ“… ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</button>
</div>

<div class="container" id="accountSelect">
  <h2>ã‚¢ã‚«ã‚¦ãƒ³ãƒˆé¸æŠ</h2>
  <button onclick="selectUser('ã‚Šã‚…ã†')">ã‚Šã‚…ã†</button>
  <button onclick="selectUser('ã‚µã‚·')">ã‚µã‚·</button>
</div>

<div class="container hidden" id="home"></div>

<div class="container hidden" id="stats">
  <h3>åˆè¨ˆç‚¹</h3>
  <p>ã‚Šã‚…ã†: <span id="totalRyu">0</span></p>
  <p>ã‚µã‚·: <span id="totalSashi">0</span></p>
  <canvas id="chart"></canvas>
</div>

<div class="container hidden" id="calendar"></div>

<script>
const tasks = [
 "8æ™‚é–“å¯ã‚‹","é‹å‹•","èµ·ãã¦ã‹ã‚‰æ°´ã‚’é£²ã‚€","å‹‰å¼·",
 "ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆãƒ•ãƒ¼ãƒ‰ã‚’é£Ÿã¹ãªã„","å¥åº·çš„ãªé£Ÿäº‹","ã‚¹ã‚­ãƒ³ã‚±ã‚¢"
];

const start = new Date(2026,0,28);
const end   = new Date(2026,1,28);

let currentUser = null;
let currentDate = todayKey();

function todayKey(){
  const d=new Date();
  return d.toISOString().slice(0,10);
}

function dateRange(){
  let arr=[];
  let d=new Date(start);
  while(d<=end){
    arr.push(d.toISOString().slice(0,10));
    d.setDate(d.getDate()+1);
  }
  return arr;
}

function load(){
  return JSON.parse(localStorage.getItem("data")||'{}');
}
function save(d){ localStorage.setItem("data",JSON.stringify(d)); }

function score(count){
  if(count===0) return 0;
  if(count<=2) return 1;
  if(count===4) return 3;
  if(count===5) return 4;
  if(count>=6) return 5;
  return 0;
}

function selectUser(u){
  currentUser=u;
  document.getElementById("accountSelect").classList.add("hidden");
  document.getElementById("menu").classList.remove("hidden");
  showHome();
}

function toggleMenu(){
  document.getElementById("menu").classList.toggle("hidden");
}

function showHome(){
  hideAll();
  renderTasks(currentDate);
  document.getElementById("home").classList.remove("hidden");
}

function showStats(){
  hideAll();
  updateStats();
  document.getElementById("stats").classList.remove("hidden");
}

function showCalendar(){
  hideAll();
  const cal=document.getElementById("calendar");
  cal.innerHTML="";
  dateRange().forEach(d=>{
    const b=document.createElement("button");
    b.textContent=d;
    b.onclick=()=>{ currentDate=d; showHome(); };
    cal.appendChild(b);
  });
  cal.classList.remove("hidden");
}

function hideAll(){
  ["home","stats","calendar"].forEach(id=>{
    document.getElementById(id).classList.add("hidden");
  });
}

function renderTasks(date){
  const home=document.getElementById("home");
  home.innerHTML=`<h3>${date}</h3>`;
  const data=load();
  data[currentUser] ??={};
  data[currentUser][date] ??=Array(7).fill(false);

  data[currentUser][date].forEach((v,i)=>{
    const div=document.createElement("div");
    div.className="task";
    div.innerHTML=`<span>${tasks[i]}</span>`;
    const cb=document.createElement("input");
    cb.type="checkbox";
    cb.checked=v;
    cb.onchange=()=>{
      data[currentUser][date][i]=cb.checked;
      save(data);
      updateStats();
    };
    div.appendChild(cb);
    home.appendChild(div);
  });
}

let chart=null;

function updateStats(){
  const data=load();
  const labels=dateRange();
  const ryu=[],sashi=[];
  let totalR=0,totalS=0;

  labels.forEach(d=>{
    const r=(data["ã‚Šã‚…ã†"]?.[d]||[]).filter(v=>v).length;
    const s=(data["ã‚µã‚·"]?.[d]||[]).filter(v=>v).length;
    const rs=score(r), ss=score(s);
    totalR+=rs; totalS+=ss;
    ryu.push(totalR); sashi.push(totalS);
  });

  document.getElementById("totalRyu").textContent=totalR;
  document.getElementById("totalSashi").textContent=totalS;

  if(chart) chart.destroy();
  chart=new Chart(document.getElementById("chart"),{
    type:"line",
    data:{
      labels,
      datasets:[
        {label:"ã‚Šã‚…ã†",data:ryu,borderColor:"blue"},
        {label:"ã‚µã‚·",data:sashi,borderColor:"red"}
      ]
    }
  });
}
</script>
</body>
</html>
